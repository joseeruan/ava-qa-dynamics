# Dynamics 365 Project Analysis Report

**Project:** {{data.project_path}}  
**Analysis Date:** {{data.timestamp}}  
**Analysis Depth:** {{data.analysis_depth}}  
**Generated by:** AVA Dynamics QA Module

---

## ðŸ“Š Executive Summary

**Components Found:**
- ðŸ”Œ Plugins: {{data.components.plugins.length}}
- ðŸ”„ Workflows: {{data.components.workflows.length}}
- ðŸŒ Custom APIs: {{data.components.custom_apis.length}}
- ðŸŽ¨ PCF Controls: {{data.components.pcf_controls.length}}

**Quality Assessment:**
- âš ï¸ Anti-Patterns Detected: {{data.antipatterns.length}}
  - ðŸ”´ HIGH Severity: {{data.antipatterns.filter(p => p.severity === 'HIGH').length}}
  - ðŸŸ¡ MEDIUM Severity: {{data.antipatterns.filter(p => p.severity === 'MEDIUM').length}}
  - ðŸŸ¢ LOW Severity: {{data.antipatterns.filter(p => p.severity === 'LOW').length}}
- ðŸ”€ Pipeline Conflicts: {{data.pipeline_conflicts.length}}

**Overall Health Score:** {{data.health_score}}/100

---

## ðŸ“¦ Components Inventory

### Plugins ({{data.components.plugins.length}})

{{#each data.components.plugins}}
#### {{this.name}}
- **File:** `{{this.file}}`
- **Registers On:** {{this.entity}} / {{this.message}}
- **Stage:** {{this.stage}} ({{this.stage_name}})
- **Execution Mode:** {{this.mode}}
- **Lines of Code:** {{this.loc}}
- **Complexity:** {{this.complexity}}

**Analysis:**
- Depth Validation: {{#if this.has_depth_check}}âœ…{{else}}âŒ{{/if}}
- Null Checks: {{#if this.has_null_checks}}âœ…{{else}}âŒ{{/if}}
- Exception Handling: {{#if this.has_try_catch}}âœ…{{else}}âŒ{{/if}}
- Tracing: {{#if this.uses_tracing}}âœ…{{else}}âŒ{{/if}}
- PreImage/PostImage: {{#if this.validates_images}}âœ…{{else}}âŒ{{/if}}

{{/each}}

---

### Custom Workflow Activities ({{data.components.workflows.length}})

{{#each data.components.workflows}}
#### {{this.name}}
- **File:** `{{this.file}}`
- **Input Parameters:** {{this.input_params.length}}
- **Output Parameters:** {{this.output_params.length}}
- **Lines of Code:** {{this.loc}}

{{/each}}

---

### Custom APIs ({{data.components.custom_apis.length}})

{{#each data.components.custom_apis}}
#### {{this.name}}
- **File:** `{{this.file}}`
- **Unique Name:** `{{this.unique_name}}`
- **Binding Type:** {{this.binding_type}}
- **Request Parameters:** {{this.request_params.length}}
- **Response Parameters:** {{this.response_params.length}}

{{/each}}

---

### PCF Controls ({{data.components.pcf_controls.length}})

{{#each data.components.pcf_controls}}
#### {{this.name}}
- **File:** `{{this.file}}`
- **Type:** {{this.control_type}}
- **Properties:** {{this.properties.length}}

{{/each}}

---

## âš ï¸ Anti-Patterns Detected

{{#each data.antipatterns}}
### {{@index}}. {{this.pattern}} ({{this.severity}})

**File:** `{{this.file}}`  
**Line:** {{this.line}}

**Issue:**
{{this.description}}

**Risk:**
{{this.risk}}

**Fix:**
```csharp
{{this.fix_code}}
```

**Impact:** {{this.impact}}

---
{{/each}}

{{#unless data.antipatterns.length}}
âœ… **No anti-patterns detected!** Your code follows Dynamics best practices.
{{/unless}}

---

## ðŸ”€ Pipeline Execution Analysis

{{#each data.pipeline_conflicts}}
### Conflict {{@index}}: {{this.type}}

**Entity:** {{this.entity}}  
**Message:** {{this.message}}  
**Stage:** {{this.stage}} ({{this.stage_name}})

**Involved Components:**
{{#each this.components}}
- {{this.name}} (Order: {{this.execution_order}})
{{/each}}

**Risk Level:** {{this.risk_level}}

**Description:**
{{this.description}}

**Recommendation:**
{{this.recommendation}}

**Priority:** {{this.priority}}

---
{{/each}}

{{#unless data.pipeline_conflicts.length}}
âœ… **No pipeline conflicts detected!** Execution order appears well-defined.
{{/unless}}

---

## ðŸ“ˆ Complexity Analysis

### Overall Metrics

| Metric | Value | Status |
|--------|-------|--------|
| Total Files | {{data.complexity.total_files}} | {{data.complexity.files_status}} |
| Total Lines of Code | {{data.complexity.total_loc}} | {{data.complexity.loc_status}} |
| Average Cyclomatic Complexity | {{data.complexity.avg_complexity}} | {{data.complexity.complexity_status}} |
| Max Complexity (Single Method) | {{data.complexity.max_complexity}} | {{data.complexity.max_status}} |

### Complexity Hotspots

**Files requiring attention (Complexity > 10):**

{{#each data.complexity.hotspots}}
- **{{this.file}}** - Complexity: {{this.complexity}}
  - Method: `{{this.method}}`
  - Recommendation: {{this.recommendation}}
{{/each}}

---

## ðŸ§ª Test Coverage Assessment

**Current State:**
- Test Project Exists: {{#if data.test_project_exists}}âœ… Yes{{else}}âŒ No{{/if}}
- Unit Tests Found: {{data.unit_tests_count}}
- Integration Tests Found: {{data.integration_tests_count}}
- Estimated Coverage: {{data.estimated_coverage}}%

**Recommendation:**
{{#if data.test_project_exists}}
Your project has tests! Consider running `qa-review` to analyze test quality.
{{else}}
No test project found. Run `qa-generate-tests` to create comprehensive test suite.
{{/if}}

---

## ðŸ“‹ Recommendations

### Immediate Actions (HIGH Priority)

{{#each data.antipatterns}}
{{#if (eq this.severity 'HIGH')}}
- [ ] **{{this.pattern}}** in `{{this.file}}:{{this.line}}`
  - {{this.recommendation}}
{{/if}}
{{/each}}

### Code Improvements (MEDIUM Priority)

{{#each data.antipatterns}}
{{#if (eq this.severity 'MEDIUM')}}
- [ ] **{{this.pattern}}** in `{{this.file}}:{{this.line}}`
  - {{this.recommendation}}
{{/if}}
{{/each}}

### Optimizations (LOW Priority)

{{#each data.antipatterns}}
{{#if (eq this.severity 'LOW')}}
- [ ] **{{this.pattern}}** in `{{this.file}}:{{this.line}}`
  - {{this.recommendation}}
{{/if}}
{{/each}}

### Pipeline Configuration

{{#each data.pipeline_conflicts}}
- [ ] **Resolve {{this.type}}** for {{this.entity}}/{{this.message}}
  - {{this.recommendation}}
{{/each}}

---

## ðŸŽ¯ Next Steps

Based on this analysis, here's what AVA recommends:

{{#if (gt data.antipatterns.length 5)}}
### 1. Code Review (Recommended)
Run `qa-review` workflow to get detailed fix suggestions for all anti-patterns.
{{/if}}

{{#unless data.test_project_exists}}
### {{#if (gt data.antipatterns.length 5)}}2{{else}}1{{/if}}. Generate Tests
Run `qa-generate-tests` to create unit and integration tests for all components.
{{/unless}}

{{#if data.pipeline_conflicts.length}}
### {{#if (gt data.antipatterns.length 5)}}{{#unless data.test_project_exists}}3{{else}}2{{/unless}}{{else}}{{#unless data.test_project_exists}}2{{else}}1{{/unless}}{{/if}}. Review Plugin Registration
Check Plugin Registration Tool to resolve execution order conflicts.
{{/if}}

### {{#if (gt data.antipatterns.length 5)}}{{#if data.pipeline_conflicts.length}}{{#unless data.test_project_exists}}4{{else}}3{{/unless}}{{else}}{{#unless data.test_project_exists}}3{{else}}2{{/unless}}{{/if}}{{else}}{{#if data.pipeline_conflicts.length}}{{#unless data.test_project_exists}}3{{else}}2{{/unless}}{{else}}{{#unless data.test_project_exists}}2{{else}}1{{/unless}}{{/if}}{{/if}}. All-in-One Setup
If you want everything at once, run `qa-quick-setup` for complete testing infrastructure.

---

## ðŸ“š References

This analysis used the following knowledge resources:
- Anti-Patterns Database: `@knowledge/antipatterns.md`
- Pipeline Execution Order: `@knowledge/pipeline-execution-order.md`
- Testing Best Practices: `@knowledge/best-practices.md`

---

## ðŸ’¡ Tips for Improvement

1. **Fix HIGH severity issues first** - They pose the most risk
2. **Review pipeline conflicts** - Execution order issues are subtle but dangerous
3. **Reduce complexity hotspots** - Files with complexity > 10 are hard to test
4. **Add tests before refactoring** - Tests give you confidence to change code
5. **Re-run analysis regularly** - Track improvements over time

---

**Report saved to:** {{data.output_path}}  
**Need help?** Ask AVA for guidance on any of these findings!
